\section{World2}

\begin{vdm_al}
class World

instance variables
  protected env : [Environment] := nil;

operations


  public World : seq of char ==> World
  World(fname) ==
	(
		duration(0)(
		env := new Environment(fname);

		env.addController(CRSystem`ctrl);
		CRSystem`ctrl.setAPM(CRSystem`apm);
		CRSystem`apm.setSMSGateway(CRSystem`gateway);
		--env.addTokenDevice(CRSystem`tok0);
		--CRSystem`tok0.setAPM(CRSystem`apm);
		--CRSystem`tok0.setEnv(env);
		env.addTokenDevice(CRSystem`tok7);

		
		
		CRSystem`tok7.setAPM(CRSystem`apm);

		
		
		CRSystem`tok7.setEnv(env);

		
		);
	);

	public run : () ==>  seq of Logger`logType
	run() == 	
	(
		--dcl i : nat := 5;
		duration(0)(
		--CRSystem`grid.initGrid();
		CRSystem`ctrl.initTrains();
		CRSystem`ctrl.initStations();
		CRSystem`ctrl.startTrains();
		CRSystem`gateway.initialize(13600,100);
		start(CRSystem`gateway);
		);

		start(env);
 		Logger`write2("World Setup complete",0,time);
		--env.isFinished();
		CRSystem`ctrl.isFinished();	
		Logger`write("This is the end");	
		env.showResults();
		return Logger`printLog();


	)
end World
\end{vdm_al}
