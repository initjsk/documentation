\begin{vdm}\kClass $TimeStamp$ \kISO $WaitNotify$
\par
\kValues
\kw{\kw{public}}\val{stepLength}[\Nat ]{10}
\kInstanceVarDef
\parlinebr
\begin{insvar}
\assdef{currentTime}{\Nat }[{0}]
\end{insvar}
\begin{insvar}
\assdef{wakeUpMap}{\mapof{\Nat \Gmap \Nat }}[{\Emptymap }]
\end{insvar}
\par
\kOperations
\kw{\kw{public}}\begin{op}[e]{WaitRelative}%
\signature{\Nat  \Oto ()}
\parms{val}
\annlab[o]{TimeStamp`WaitRelative}
\begin{blockstmt}
\call{AddToWakeUpMap}{\kw{threadid},currentTime + val} ; \\
\call{WaitNotify`Wait}{}
\end{blockstmt};
\end{op}
\kw{\kw{public}}\begin{op}[e]{WaitAbsolute}%
\signature{\Nat  \Oto ()}
\parms{val}
\annlab[o]{TimeStamp`WaitAbsolute}
\begin{blockstmt}
\call{AddToWakeUpMap}{\kw{threadid},val} ; \\
\call{WaitNotify`Wait}{}
\end{blockstmt};
\end{op}
\begin{op}[e]{AddToWakeUpMap}%
\signature{\Nat  \X \Nat  \Oto ()}
\parms{tId,val}
\annlab[o]{TimeStamp`AddToWakeUpMap}
\ass{wakeUpMap}{wakeUpMap \Override \map{tId \Mapsto val}};
\end{op}
\kw{\kw{public}}\begin{op}[e]{NotifyThread}%
\signature{\Nat  \Oto ()}
\parms{tId}
\annlab[o]{TimeStamp`NotifyThread}
\begin{blockstmt}
\ass{wakeUpMap}{\set{tId} \Dby wakeUpMap} ; \\
\call{WaitNotify`NotifyThread}{tId}
\end{blockstmt};
\end{op}
\kw{\kw{public}}\begin{op}[e]{Notify}%
\signature{() \Oto ()}
\parms{}
\annlab[o]{TimeStamp`Notify}
\Letbe* tId \In  \Dom wakeUpMap \Lin \\
\call{NotifyThread}{tId};
\end{op}
\kw{\kw{public}}\begin{op}[e]{NotifyAll}%
\signature{() \Oto ()}
\parms{}
\annlab[o]{TimeStamp`NotifyAll}
\begin{blockstmt}
\ass{wakeUpMap}{\Emptymap } ; \\
\call{WaitNotify`NotifyAll}{}
\end{blockstmt};
\end{op}
\kw{\kw{public}}\begin{op}[e]{NotifyAndIncTime}%
\signature{() \Oto ()}
\parms{}
\annlab[o]{TimeStamp`NotifyAndIncTime}
\begin{blockstmt}
\ass{currentTime}{currentTime + stepLength} ; \\
\begin{setfor}{t}{ \Dom \pex{wakeUpMap \Rto \setrange{1}{currentTime}}}
\call{NotifyThread}{t}
\end{setfor}
\end{blockstmt};
\end{op}
\kw{\kw{public}}\begin{op}[e]{GetTime}%
\signature{() \Oto \Nat }
\parms{}
\annlab[o]{TimeStamp`GetTime}
\return{currentTime}
\end{op}
\kSync
\mutex{AddToWakeUpMap,Notify,NotifyThread,NotifyAll}
\kEnd $TimeStamp$

\end{vdm}
































































\begin{tabular}{p{25mm}l}
{\bf Test Suite :} & vdm.tc \\ 
{\bf Class :} & TimeStamp \\ 
\end{tabular}

\begin{longtable}{|l|r|r|}\hline
{\bf TimeStamp`NotifyAndIncTime} & {\bf \#Calls} & {\bf Coverage} \kill
{\bf Name} & {\bf \#Calls} & {\bf Coverage} \\ \hline\hline
\endhead
TimeStamp`Notify & {\bf undefined} &  {\bf undefined}  \\ \hline
TimeStamp`GetTime & {\bf undefined} &  {\bf undefined}  \\ \hline
TimeStamp`NotifyAll & {\bf undefined} &  {\bf undefined}  \\ \hline
TimeStamp`NotifyThread & {\bf undefined} &  {\bf undefined}  \\ \hline
TimeStamp`WaitAbsolute & {\bf undefined} &  {\bf undefined}  \\ \hline
TimeStamp`WaitRelative & {\bf undefined} &  {\bf undefined}  \\ \hline
TimeStamp`AddToWakeUpMap & {\bf undefined} &  {\bf undefined}  \\ \hline
TimeStamp`NotifyAndIncTime & {\bf undefined} &  {\bf undefined}  \\ \hline
\hline
{\bf Total Coverage} & & {\bf 0\%} \\ \hline
\end{longtable}



